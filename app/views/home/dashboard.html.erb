<br/>
<br/>
<br/>

<div class="content dashboard">
  <div class="generic-widget">
    <form class="date-entry form_field" action=<%= "#{dashboard_invoices_path}" %> method="get">
      <span class="from-date">
        <p class="">From</p>
        <input class="email-input dashboard-report-from-date" name="from" value=<%= "#{@from}" %> placeholder="DD-MM-YYYY">
      </span>

      <span class="to-date">
        <p class="">To</p>
        <input class="email-input dashboard-report-to-date" name="to" value=<%= "#{@to}" %> placeholder="DD-MM-YYYY">
      </span>

      <span class="search">
        <input class="btn btn-primary report-submit" type="submit" value="Update Report"/>
      </span>
    </form>

    <div class="entry">
      <a href=<%= search_invoices_path(:conflict => false, :from_date => @from, :to_date => @to) %>>
        <%= @reports.total('currency_breakdown') %> expenses incurred
      </a>

      <div class="currency-breakdown">
        <% @reports.currency_breakdown.each do |b| %>
        <span class="currency-breakdown-item">
          <%= "#{b['currency']} #{b['sum']}" %>
        </span>
        <% end %>
      </div>
    </div>

    <hr class="space-three-bottom">

    <div class="entry">
      <a href=<%= search_invoices_path(:status => 'Extracted', :expense_type => 'Company', :conflict => false,
                                       :from_date => @from, :to_date => @to) %>>
        <%= @reports.total('awaiting_review') %> expense(s) needs reviewing
      </a>

      <div class="currency-breakdown">
        <% @reports.awaiting_review.each do |b| %>
        <span class="currency-breakdown-item">
          <%= "#{b['currency']} #{b['sum']}" %>
        </span>
        <% end %>
      </div>
    </div>

    <div class="entry">
      <a href=<%= search_invoices_path(:status => 'Extracted', :expense_type => 'Reimbursement', :conflict => false,
                                       :from_date => @from, :to_date => @to) %>>
        <%= @reports.total('awaiting_approval') %> expense(s) need to be reimbursed
      </a>

      <div class="currency-breakdown">
        <% @reports.awaiting_approval.each do |b| %>
        <span class="currency-breakdown-item">
          <%= "#{b['currency']} #{b['sum']}" %>
        </span>
        <% end %>
      </div>
    </div>

    <div class="entry">
      <a href=<%= search_invoices_path(:status => 'Reviewed', :conflict => false,
                                       :from_date => @from, :to_date => @to) %>>
        <%= @reports.total('reviewed') %> have already been reviewed
      </a>

      <div class="currency-breakdown">
        <% @reports.reviewed.each do |b| %>
        <span class="currency-breakdown-item">
          <%= "#{b['currency']} #{b['sum']}" %>
        </span>
        <% end %>
      </div>
    </div>

    <hr class="space-three-bottom">

    <div class="entry">
      this excludes
      <a href=<%= search_invoices_path(:status => 'Submitted', :conflict => false,
                                       :from_date => @from, :to_date => @to) %>>
        <%= @reports.total('submitted') %> submitted expense(s)
      </a>

      and
      <a href=<%= search_invoices_path(:conflict => false) %>>
        <%= @reports.total('conflicted') %> expense(s)
      </a>
      that are in dispute
    </div>
  </div>

  <hr class="space-three-bottom">

  <div class="category-widget">
    <div class="category-table">
      <ul class="items">
        <% @reports.category_breakdown.each do |k, v| %>
          <li class="item-row">
            <span class="item-key">
              <%= k %>
            </span>

            <div class="item-value">
              <% v.each do |b| %>
              <span>
                <%= Money.new(b['sum'].to_i * 100, b['currency']).format %>
                <br/>
              </span>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
    </div>
  </div>

  <br/>
  <br/>
  <br/>
  <br/>
</div>


<%= javascript_tag do %>
  new Pikaday({
    field: $('.dashboard-report-from-date')[0],
    format: 'YYYY-MM-DD'
  });

  new Pikaday({
    field: $('.dashboard-report-to-date')[0],
    format: 'YYYY-MM-DD'
  });
<% end %>
